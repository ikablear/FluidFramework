{
"title": "SparseNode Class",
"summary": "Sparse Tree of nodes.\n\nContains both child and parent pointers, which are kept in sync.\n\nEach node is equivalent to a path through the tree. This tree structure stores a collection of these paths, but deduplicating the common prefixes of the tree prefix-tree style.",
"kind": "Class",
"members": {
"Constructor": {
"(constructor)": "/docs/apis/tree/sparsenode-class#_constructor_-constructor"
},
"Method": {
"afterEmptyField": "/docs/apis/tree/sparsenode-class#afteremptyfield-method",
"getOrCreateChild": "/docs/apis/tree/sparsenode-class#getorcreatechild-method",
"removeChild": "/docs/apis/tree/sparsenode-class#removechild-method",
"tryGetChild": "/docs/apis/tree/sparsenode-class#trygetchild-method"
},
"Property": {
"children": "/docs/apis/tree/sparsenode-class#children-property",
"data": "/docs/apis/tree/sparsenode-class#data-property",
"parent": "/docs/apis/tree/sparsenode-class#parent-property",
"parentField": "/docs/apis/tree/sparsenode-class#parentfield-property",
"parentIndex": "/docs/apis/tree/sparsenode-class#parentindex-property",
"parentPath": "/docs/apis/tree/sparsenode-class#parentpath-property"
}
},
"package": "@fluid-internal/tree",
"unscopedPackageName": "tree"
}

[//]: # "Do not edit this file. It is automatically generated by @fluidtools/api-markdown-documenter."

[Packages](/docs/apis/) &gt; [@fluid-internal/tree](/docs/apis/tree) &gt; [SparseNode](/docs/apis/tree/sparsenode-class)

Sparse Tree of nodes.

Contains both child and parent pointers, which are kept in sync.

Each node is equivalent to a path through the tree. This tree structure stores a collection of these paths, but deduplicating the common prefixes of the tree prefix-tree style.

## Signature {#sparsenode-signature}

```typescript
export declare class SparseNode<TData> implements UpPath
```

<b>Implements:</b> [UpPath](/docs/apis/tree/uppath-interface)

<b>Type parameters:</b>

-   <b>TData</b>

## Constructors

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th scope="col">
        Constructor
      </th>
      <th scope="col">
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <a href='/docs/apis/tree/sparsenode-class#_constructor_-constructor'>(constructor)</a>
      </td>
      <td>
        Constructs a new instance of the <code>SparseNode</code> class
      </td>
    </tr>
  </tbody>
</table>

## Properties

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th scope="col">
        Property
      </th>
      <th scope="col">
        Type
      </th>
      <th scope="col">
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <a href='/docs/apis/tree/sparsenode-class#children-property'>children</a>
      </td>
      <td>
        Map<<a href='/docs/apis/tree#fieldkey-typealias'>FieldKey</a>, <a href='/docs/apis/tree/sparsenode-class'>SparseNode</a><TData>[]>
      </td>
      <td>
        <p>SparseNode arrays are kept sorted the SparseNode's parentIndex for efficient search. Users of this field must take care to maintain invariants (correct parent pointers, not empty child arrays etc.)</p><p>Performance Note: Large child lists could be updated more efficiently here using a data-structure optimized for efficient prefix sum updates, such as a Fenwick tree or Finger tree. This would be complicated by the need for parent pointers (including indexes), but is possible to do.</p>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/tree/sparsenode-class#data-property'>data</a>
      </td>
      <td>
        TData
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/tree/sparsenode-class#parent-property'>parent</a>
      </td>
      <td>
        <a href='/docs/apis/tree/sparsenode-class'>SparseNode</a><TData> | undefined
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/tree/sparsenode-class#parentfield-property'>parentField</a>
      </td>
      <td>
        <a href='/docs/apis/tree#fieldkey-typealias'>FieldKey</a>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/tree/sparsenode-class#parentindex-property'>parentIndex</a>
      </td>
      <td>
        number
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/tree/sparsenode-class#parentpath-property'>parentPath</a>
      </td>
      <td>
        <a href='/docs/apis/tree/sparsenode-class'>SparseNode</a><TData> | undefined
      </td>
      <td>
        <p>The parent of this <code>SparseNode</code> (an up pointer in the <code>SparseNode</code> tree). If the status of this node is <code>Alive</code>, then there must be a corresponding down pointer from the <code>parentPath</code> node to this node. When undefined, this node is the root and thus has no parent.</p><p>When updating the tree, it is valid to transiently leave the up and down pointers inconsistent (updating down pointers first), but they must be consistent when the update is completed.</p>
      </td>
    </tr>
  </tbody>
</table>

## Methods

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th scope="col">
        Method
      </th>
      <th scope="col">
        Return Type
      </th>
      <th scope="col">
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        <a href='/docs/apis/tree/sparsenode-class#afteremptyfield-method'>afterEmptyField</a>
      </td>
      <td>
        void
      </td>
      <td>
        Call this after directly editing the child array for a field to be empty. Handles cleaning up unneeded data (like the field in the map, and possibly this entire SparseNode and its parents if they are no longer needed.)
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/tree/sparsenode-class#getorcreatechild-method'>getOrCreateChild</a>
      </td>
      <td>
        <a href='/docs/apis/tree/sparsenode-class'>SparseNode</a><TData>
      </td>
      <td>
        Gets a child, adding a ref to it. Creates child (with 1 ref) if needed.
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/tree/sparsenode-class#removechild-method'>removeChild</a>
      </td>
      <td>
        void
      </td>
      <td>
        Removes reference from this to <code>child</code>. Since PathNodes are doubly linked, the caller must ensure that the reference from child to parent is also removed (or the child is no longer used).
      </td>
    </tr>
    <tr>
      <td>
        <a href='/docs/apis/tree/sparsenode-class#trygetchild-method'>tryGetChild</a>
      </td>
      <td>
        <a href='/docs/apis/tree/sparsenode-class'>SparseNode</a><TData> | undefined
      </td>
      <td>
        Gets a child if it exists. Does NOT add a ref.
      </td>
    </tr>
  </tbody>
</table>

## Constructor Details

### (constructor) {#_constructor_-constructor}

Constructs a new instance of the `SparseNode` class

#### Signature {#_constructor_-signature}

```typescript
constructor(parentField: FieldKey, parentIndex: number,
    parentPath: SparseNode<TData> | undefined, data: TData);
```

#### Parameters {#_constructor_-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th scope="col">
        Parameter
      </th>
      <th scope="col">
        Type
      </th>
      <th scope="col">
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        parentField
      </td>
      <td>
        <a href='/docs/apis/tree#fieldkey-typealias'>FieldKey</a>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        parentIndex
      </td>
      <td>
        number
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        parentPath
      </td>
      <td>
        <a href='/docs/apis/tree/sparsenode-class'>SparseNode</a><TData> | undefined
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        data
      </td>
      <td>
        TData
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

## Property Details

### children {#children-property}

SparseNode arrays are kept sorted the SparseNode's parentIndex for efficient search. Users of this field must take care to maintain invariants (correct parent pointers, not empty child arrays etc.)

Performance Note: Large child lists could be updated more efficiently here using a data-structure optimized for efficient prefix sum updates, such as a Fenwick tree or Finger tree. This would be complicated by the need for parent pointers (including indexes), but is possible to do.

#### Signature {#children-signature}

```typescript
readonly children: Map<FieldKey, SparseNode<TData>[]>;
```

### data {#data-property}

#### Signature {#data-signature}

```typescript
data: TData;
```

### parent {#parent-property}

#### Signature {#parent-signature}

```typescript
get parent(): SparseNode<TData> | undefined;
```

### parentField {#parentfield-property}

#### Signature {#parentfield-signature}

```typescript
parentField: FieldKey;
```

### parentIndex {#parentindex-property}

#### Signature {#parentindex-signature}

```typescript
parentIndex: number;
```

### parentPath {#parentpath-property}

The parent of this `SparseNode` (an up pointer in the `SparseNode` tree). If the status of this node is `Alive`<!-- -->, then there must be a corresponding down pointer from the `parentPath` node to this node. When undefined, this node is the root and thus has no parent.

When updating the tree, it is valid to transiently leave the up and down pointers inconsistent (updating down pointers first), but they must be consistent when the update is completed.

#### Signature {#parentpath-signature}

```typescript
parentPath: SparseNode<TData> | undefined;
```

## Method Details

### afterEmptyField {#afteremptyfield-method}

Call this after directly editing the child array for a field to be empty. Handles cleaning up unneeded data (like the field in the map, and possibly this entire SparseNode and its parents if they are no longer needed.)

#### Signature {#afteremptyfield-signature}

```typescript
afterEmptyField(key: FieldKey): void;
```

#### Parameters {#afteremptyfield-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th scope="col">
        Parameter
      </th>
      <th scope="col">
        Type
      </th>
      <th scope="col">
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        key
      </td>
      <td>
        <a href='/docs/apis/tree#fieldkey-typealias'>FieldKey</a>
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

### getOrCreateChild {#getorcreatechild-method}

Gets a child, adding a ref to it. Creates child (with 1 ref) if needed.

#### Signature {#getorcreatechild-signature}

```typescript
getOrCreateChild(key: FieldKey, index: number, data: () => TData): SparseNode<TData>;
```

#### Parameters {#getorcreatechild-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th scope="col">
        Parameter
      </th>
      <th scope="col">
        Type
      </th>
      <th scope="col">
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        key
      </td>
      <td>
        <a href='/docs/apis/tree#fieldkey-typealias'>FieldKey</a>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        index
      </td>
      <td>
        number
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        data
      </td>
      <td>
        () => TData
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#getorcreatechild-returns}

<b>Return type:</b> [SparseNode](/docs/apis/tree/sparsenode-class)<!-- -->&lt;TData&gt;

### removeChild {#removechild-method}

Removes reference from this to `child`<!-- -->. Since PathNodes are doubly linked, the caller must ensure that the reference from child to parent is also removed (or the child is no longer used).

#### Signature {#removechild-signature}

```typescript
removeChild(child: SparseNode<TData>): void;
```

#### Parameters {#removechild-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th scope="col">
        Parameter
      </th>
      <th scope="col">
        Type
      </th>
      <th scope="col">
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        child
      </td>
      <td>
        <a href='/docs/apis/tree/sparsenode-class'>SparseNode</a><TData>
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

### tryGetChild {#trygetchild-method}

Gets a child if it exists. Does NOT add a ref.

#### Signature {#trygetchild-signature}

```typescript
tryGetChild(key: FieldKey, index: number): SparseNode<TData> | undefined;
```

#### Parameters {#trygetchild-parameters}

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th scope="col">
        Parameter
      </th>
      <th scope="col">
        Type
      </th>
      <th scope="col">
        Description
      </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        key
      </td>
      <td>
        <a href='/docs/apis/tree#fieldkey-typealias'>FieldKey</a>
      </td>
      <td>
      </td>
    </tr>
    <tr>
      <td>
        index
      </td>
      <td>
        number
      </td>
      <td>
      </td>
    </tr>
  </tbody>
</table>

#### Returns {#trygetchild-returns}

<b>Return type:</b> [SparseNode](/docs/apis/tree/sparsenode-class)<!-- -->&lt;TData&gt; \| undefined
